# Dense reward configuration for Lift task
reward_mode: "dense"

# Reward type: "parallel" (all components at once) or "staged" (curriculum)
reward_type: "parallel"

# Reward weights (use negative for penalty)
weights:
  approach: 20.0        # Approach cube (TCP midpoint or both jaw points in dual_point mode)
  grasp: 100.0           # Bonus for successfully grasping the cube (binary, base weight if adaptive)
  horizontal_displacement: -1.0  # Penalize cube XY displacement from initial position
  lift: 50.0           # Lift cube up (height in meters, scaled up)
  action_rate: -1.0    # Penalize action changes (anti-jitter), range ~[0, 0.2]
  success: 100.0        # Task completion bonus
  fail: -100.0         # Penalty when cube goes out of bounds

# Adaptive grasp weight: dynamically scale grasp reward by inverse success rate
# Formula: dynamic_weight = base_weight * (1 / (success_rate + eps))^alpha
# This boosts rare events (successful grasps) to provide stronger learning signal
adaptive_grasp_weight:
  enabled: true         # Enable adaptive weighting
  alpha: 0.5            # Exponent for inverse scaling (0.5 = sqrt, 1.0 = linear inverse)
  eps: 0.01             # Floor for success rate to prevent division by zero
  max_weight: 10000.0    # Cap to prevent weight explosion
  tau: 0.01             # EMA decay rate for tracking success rate

# Gated lift reward: only give lift reward when is_grasped=True
# This prevents the agent from pushing the cube up without grasping it
gate_lift_with_grasp: true

# Adaptive lift weight: dynamically scale lift reward by inverse success rate
# Formula: dynamic_weight = base_weight * (1 / (success_rate + eps))^alpha
# This boosts rare lift events to provide stronger learning signal
adaptive_lift_weight:
  enabled: true         # Enable adaptive weighting
  alpha: 0.5            # Exponent for inverse scaling (0.5 = sqrt, 1.0 = linear inverse)
  eps: 0.01             # Floor for success rate to prevent division by zero
  max_weight: 10000.0    # Cap to prevent weight explosion
  tau: 0.01             # EMA decay rate for tracking success rate

# Approach reward curve configuration
# approach_curve options:
#   - "linear": Piecewise linear (1.0 if d<threshold, linear decay to 0 at zero_point)
#   - "tanh": Smooth tanh curve: reward = 1 - tanh(distance / scale)
approach_curve: "tanh"

# approach_mode options:
#   - "tcp_midpoint": Use TCP center (fingertips midpoint) like reference implementation
#   - "dual_point": Use separate fixed jaw (approach) and moving jaw (approach2) points
approach_mode: "tcp_midpoint"

# Linear curve parameters
approach_threshold: 0.005     # Distance for full reward (0.5cm)
approach_zero_point: 0.20    # Distance where reward becomes 0 (20cm)

# Tanh curve parameters
approach_tanh_scale: 0.05    # Scale for tanh: smaller = steeper gradient near 0

# Horizontal displacement threshold: only penalize displacement > threshold
# penalty = max(0, displacement - threshold) * weight
horizontal_displacement_threshold: 0.1  # 10cm tolerance for small movements

# Gripper reference point offsets (in meters)
# The reference point is where the cube center should be when properly grasped
gripper_tip_offset: 0.015    # Along jaw: back from tip (1.5cm)
gripper_outward_offset: 0.015  # Perpendicular: outward for cube (1.5cm)

# Moving jaw (approach2) reference point and reward curve
# Direction: local (-0.2, -1, 0.23) normalized, scale 1.8
moving_jaw_tip_offset: 0.015   # Along jaw direction: back from tip
moving_jaw_outward_offset: 0.015  # Along local -X: towards the cube center
approach2_threshold: 0.01      # Distance for full reward (1cm)
approach2_zero_point: 0.20     # Distance where reward becomes 0 (20cm)

# Lift reward height range (meters)
# lift_reward = clamp(height, 0, lift_max_height) * weight
lift_max_height: 0.10        # Cap lift reward at 10cm (no reward increase above this)

# Grasp detection parameters (for is_grasping reward gating)
grasp_min_force: 0.5         # Minimum contact force in Newtons to count as grasping
grasp_max_angle: 110         # Maximum angle (degrees) between contact force and gripper opening direction

# Success condition: cube must stay >= lift_target for stable_hold_time seconds
lift_target: 0.05           # Height threshold (5cm)
stable_hold_time: 3.0      # Required hold time in seconds (at 30Hz = 30 steps per second)

# Fail condition: cube XY must stay within this rectangle (meters)
# If cube goes outside, episode terminates with fail penalty
# Set to null or remove to disable bounds checking
fail_bounds:
  x_min: 0.35   
  x_max: 0.55
  y_min: 0.15
  y_max: 0.35

# Spawn bounds: where the red cube is randomly spawned at episode start
# If not set, uses the default grid_bounds["right"] from environment
spawn_bounds:
  x_min: 0.45
  x_max: 0.48
  y_min: 0.23
  y_max: 0.25

# Stage thresholds (for staged reward)
stages:
  approach_threshold: 0.05  # Distance to unlock next stage (5cm)
  grasp_threshold: 0.03     # Distance to consider grasped (3cm)
  lift_target: 0.05         # Height for success (5cm)
